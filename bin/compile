#!/usr/bin/env bash
# -------------------------------------------------------------------
# Copyright IBM Corp. 2013 All Rights Reserved                      
# -------------------------------------------------------------------
BUILD_DIR=$1
CACHE_DIR=$2
BUILD_PACK_DIR=$(dirname $(dirname $0))

set -e
set -o pipefail

cd $BUILD_DIR

#aptitude show sshpass # not installed
#whoami # vcap
#sudo aptitude show openssh-server # sudo: no tty present and no askpass program specified
# echo c1oudc0w | sudo -S aptitude show openssh-server # [sudo] password for vcap: Sorry, try again

#
# https://github.com/cloudfoundry-incubator/diego-release/issues/114
#
# You cannot get root in a buildpack lifecycle container. The vcap account in the root file system is explicitly disabled in /etc/passwd and there is no password defined for the user in /etc/shadow.
#

gcc app.c -o app

echo "Creating start script"
cat > "$BUILD_DIR/start.sh" <<EOF
#!/bin/bash
# Start C Application Server
echo "Starting C Application Server"
echo Port is $PORT
/home/vcap/app/app
EOF

chmod 755 "$BUILD_DIR/start.sh"
